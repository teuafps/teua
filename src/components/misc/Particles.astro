<div id="particles-js" class="fixed inset-0 pointer-events-none -z-10"></div>

<script is:inline src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script is:inline>
function initParticles() {
    if (window.particlesJS) {
        particlesJS('particles-js', {
            "particles": {
                "number": { "value": 40, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": "#ffffff" },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.3, "random": true },
                "size": { "value": 3, "random": true },
                "line_linked": { "enable": false },
                "move": {
                    "enable": true,
                    "speed": 1,
                    "direction": "top",
                    "random": true,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false,
                }
            },
            "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false } } },
            "retina_detect": true
        });
        
        // Update color based on theme
        const updateParticleColor = () => {
            const isDark = document.documentElement.classList.contains('dark');
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary');
            if (window.pJSDom && window.pJSDom[0]) {
                window.pJSDom[0].pJS.particles.color.value = isDark ? primaryColor : primaryColor;
                window.pJSDom[0].pJS.fn.particlesRefresh();
            }
        };
        
        // Listen for theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    updateParticleColor();
                }
            });
        });
        observer.observe(document.documentElement, { attributes: true });
    }
}

initParticles();

// Support for Swup transitions
document.addEventListener('swup:enable', () => {
    window.swup.hooks.on('content:replace', () => {
        if (!document.getElementById('particles-js')) {
            const div = document.createElement('div');
            div.id = 'particles-js';
            div.className = 'fixed inset-0 pointer-events-none -z-10';
            document.body.appendChild(div);
            initParticles();
        }
    });
});
</script>
